name: Release Please

on:
  push:
    branches:
      - main

jobs:
  release-please:
    runs-on: ubuntu-latest
    steps:
      - name: Release Please Action
        uses: google-github-actions/release-please-action@v3
        id: release
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          command: github-release
          release-type: simple
          package-name: release-please-demo
          draft: true
          pull-request-title-pattern: "chore${scope}: release${component} ${version}"
          conventional-commits: false
          changelog-types: '[{"type":"feat","section":"ğŸš€ Features","hidden":false},{"type":"fix","section":"ğŸ› Bug Fixes","hidden":false},{"type":"perf","section":"âš¡ Performance Improvements","hidden":false},{"type":"revert","section":"âª Reverts","hidden":false},{"type":"docs","section":"ğŸ“ Documentation","hidden":false},{"type":"style","section":"ğŸ’„ Styles","hidden":false},{"type":"refactor","section":"â™»ï¸ Code Refactoring","hidden":false},{"type":"test","section":"âœ… Tests","hidden":false},{"type":"build","section":"ğŸ”§ Build System","hidden":false},{"type":"ci","section":"ğŸ‘· CI","hidden":false},{"type":"chore","section":"ğŸ”¨ Miscellaneous","hidden":false}]'

      # Output when draft release is created
      - name: Draft Release Created
        if: ${{ steps.release.outputs.release_created }}
        run: |
          echo "ğŸ‰ Draft Release Created from PR titles!"
          echo "ğŸ“¦ Tag: ${{ steps.release.outputs.tag_name }}"
          echo "ğŸ“ CHANGELOG.md generated from merged PR titles"
          echo "ğŸ”— Draft Release URL: https://github.com/${{ github.repository }}/releases"
          echo "âœ… Review and publish the draft release when ready"

      # Output when no releasable changes found
      - name: No Release Changes
        if: ${{ !steps.release.outputs.release_created }}
        run: |
          echo "â„¹ï¸ No releasable PR titles found since last release"
          echo "ğŸ“ PR titles must use conventional format:"
          echo "   feat: add new feature"
          echo "   fix: resolve bug issue"
          echo "   feat!: breaking change"
